#!/bin/bash

source .bin.env;

sedi()
{
    sed --version >/dev/null 2>&1 && sed -i -- "$@" || sed -i "" "$@";
}

prepare()
{
    echo "Filling docker-compose.yml...";

    if [ ! -f ${ROOT}/docker-compose.yml ]; then
        rm ${ROOT}/docker-compose.yml;
    fi;

    cp ${ROOT}/docker-compose.yml.template ${ROOT}/docker-compose.yml;

    sedi "s/#- \${CERTS_PATH}/- \${CERTS_PATH}/g" ${ROOT}/docker-compose.yml;
    if [ ${WITH_XDEBUG} = 0 ]; then
        sedi "s/- \${CERTS_PATH}/#- \${CERTS_PATH}/g" ${ROOT}/docker-compose.yml;
    fi;

    sedi "s/#- .\/apache\/ext-xdebug.ini/- .\/apache\/ext-xdebug.ini/g" ${ROOT}/docker-compose.yml;
    if [ ${WITH_SSL} = 0 ]; then
        sedi "s/- .\/apache\/ext-xdebug.ini/#- .\/apache\/ext-xdebug.ini/g" ${ROOT}/docker-compose.yml;
    fi;

    echo "Done :)";
}

prepare;

exit 0;